---
id: 26
title: "TypeScript+@nuxt/test-utilsã§E2Eãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹"
date: "2021-02-19 00:00:00"
---

@nuxt/test-utilsã‚’åˆ©ç”¨ã—ãŸE2Eãƒ†ã‚¹ãƒˆã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’TypeScriptã§è¨˜è¿°ã™ã‚‹æ–¹æ³•ã‚’èª¿ã¹ã¾ã—ãŸã€‚

<!--more-->

## æ¤œè¨¼ç’°å¢ƒ

```json
  "devDependencies": {
    "@babel/core": "^7.12.16",
    "@babel/preset-env": "^7.12.16",
    "@nuxt/test-utils": "^0.1.3",
    "@types/jest": "^26.0.20",
    "babel-jest": "^26.6.3",
    "jest": "^26.6.3",
    "playwright": "^1.8.1",
    "ts-jest": "^26.5.1",
    "typescript": "^4.1.5"
  },
  "dependencies": {
    "nuxt": "^2.15.0"
  }
```

[sandbox_circleci_nuxt-test-utils](https://github.com/krabben16/sandbox_circleci_nuxt-test-utils)

## ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã® [Testing in a browser](https://test-utils.nuxtjs.org/api-reference/browser-testing) ã‚’åƒè€ƒã«ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã—ãŸã€‚ãƒ†ã‚¹ãƒˆã®æµã‚Œã¯ä»¥ä¸‹ã§ã™ã€‚

1. `setupTest` ã§ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®Nuxtã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã ã¨Chromiumï¼‰ã‚’èµ·å‹•ã™ã‚‹ã€‚
1. `test` ã§ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«é·ç§»ã—ã€CSSã‚»ãƒ¬ã‚¯ã‚¿ (.title) ã‹ã‚‰å–å¾—ã—ãŸè¦ç´ ã®innerTextãŒ "fixture" ã¨ä¸€è‡´ã™ã‚‹ã‹ãƒ†ã‚¹ãƒˆã™ã‚‹ã€‚

```ts
// test/e2e/index.spec.ts
import { setupTest, createPage } from '@nuxt/test-utils'

describe('Browser', () => {
  setupTest({
    browser: true,
  })

  test('test/fixture/pages/index.vue', async () => {
    const page = await createPage('/')
    const actual = await page.innerText('.title')
    const expected = 'fixture'
    expect(actual).toEqual(expected)
  })
})
```

## ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ

@nuxt/test-utilsã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã ã¨ test/fixture/nuxt.config.js ã‚’å‚ç…§ã—ã¦Nuxtã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã¾ã™ã€‚sandboxã§ã¯ [test/fixture](https://github.com/krabben16/sandbox_circleci_nuxt-test-utils/tree/main/test/fixture) ä»¥ä¸‹ã«Nuxtãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚

## ãƒ†ã‚¹ãƒˆå®Ÿè¡Œç’°å¢ƒã‚’ä½œæˆ

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ç’°å¢ƒã«ã‚ˆã£ã¦ç™ºç”Ÿã™ã‚‹å•é¡Œã‚’å›é¿ã™ã‚‹ãŸã‚Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã—ã¾ã™ã€‚@nuxt/test-utilsã®å†…éƒ¨ã§ã¯Playwright (APIã§ãƒ–ãƒ©ã‚¦ã‚¶ã‚’æ“ä½œã™ã‚‹Nodeãƒ©ã‚¤ãƒ–ãƒ©ãƒª) ãŒå‹•ã„ã¦ãŠã‚Šã€Playwrightå…¬å¼ã«ã‚ˆã£ã¦Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚ä»Šå›ã¯ [ã“ã®ã‚¤ãƒ¡ãƒ¼ã‚¸](https://playwright.dev/docs/docker) ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

```dockerfile
// infra/playwright/Dockerfile
FROM mcr.microsoft.com/playwright:bionic

RUN apt-get update

ENV PROJECT_ROOT=/var/www/playwright
WORKDIR $PROJECT_ROOT

COPY package.json .
COPY yarn.lock .
RUN yarn install
```

## ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ

ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆå¾Œã€ã‚³ãƒ³ãƒ†ãƒŠã«å…¥ã£ã¦ `yarn test` ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```sh
docker-compose exec playwright bash
```

```sh
yarn test
```

## å®Ÿè¡Œçµæœ

```log
yarn run v1.22.5
$ jest test/e2e
  console.info
    Using components loader to optimize imports

      at node_modules/@nuxt/components/dist/index.js:167:15

  console.info
    Discovered Components: test/fixture/.nuxt/8sgi4095/components/readme.md

      at node_modules/@nuxt/components/dist/index.js:230:13

 PASS  test/e2e/index.spec.ts (22.76 s)
  Browser
    âˆš setup nuxt (18427 ms)
    âˆš test/fixture/pages/index.vue (955 ms)

Test Suites: 1 passed, 1 total
Tests:       2 passed, 2 total
Snapshots:   0 total
Time:        22.895 s
Ran all test suites matching /test\\e2e/i.
Done in 25.17s.
```

ãƒ†ã‚¹ãƒˆãŒç„¡äº‹ã«ãƒ‘ã‚¹ã—ã¾ã—ãŸğŸ‘
